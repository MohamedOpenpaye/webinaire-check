<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Vérification d'éligibilité</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 400px;
      margin: auto;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #0d6efd;
      color: white;
      cursor: pointer;
      border: none;
    }
    #resultMessage {
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h3>Accédez au webinaire</h3>
  <p>Vérification de votre éligibilité en cours...</p>
  <p id="resultMessage"></p>

 <script>
  function verifierEligibilite(visitorId) {
    const result = document.getElementById("resultMessage");

    if (!visitorId) {
      result.textContent = "❌ Identifiant Intercom manquant.";
      result.style.color = "red";
      return;
    }

    result.textContent = "⏳ Vérification en cours...";
    result.style.color = "#333";

    fetch(`https://webinaire-check.vercel.app/api/check-eligibility?visitorId=${encodeURIComponent(visitorId)}`)
      .then(res => res.json())
      .then(data => {
        if (data.eligible) {
          result.textContent = "✅ Accès autorisé. Chargement du contenu...";
          result.style.color = "green";
          window.parent.postMessage({ type: "afficher-section", sectionId: "section_1729871499679_376" }, "*");
        } else {
          result.textContent = "❌ Ce webinaire est réservé aux utilisateurs récents.";
          result.style.color = "red";
        }
      })
      .catch(err => {
        console.error("Erreur API :", err);
        result.textContent = "❌ Erreur lors de la vérification.";
        result.style.color = "red";
      });
  }

  window.addEventListener("message", function (event) {
    if (event.data && event.data.type === "fromParent" && event.data.visitorId) {
      verifierEligibilite(event.data.visitorId);
    }
  });

  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("resultMessage").textContent = "⏳ En attente des données utilisateur...";
  });
</script>

</body>
</html>
